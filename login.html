<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BJC PRIME LOGIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
    font-family: Arial, sans-serif;
    background:#111;
    color:white;
    text-align:center;
    padding:40px;
}
.box{
    background:#222;
    padding:20px;
    border-radius:10px;
    max-width:350px;
    margin:auto;
}
input{
    width:100%;
    padding:12px;
    margin-top:10px;
    border:none;
    border-radius:8px;
}
button{
    margin-top:15px;
    width:100%;
    padding:12px;
    border:none;
    background:#00a8ff;
    color:white;
    font-size:18px;
    border-radius:8px;
}
</style>

<!-- License Data -->
<script src="license.js"></script>
</head>
<body>

<h2>BJC PRIME LOGIN</h2>

<div class="box">
    <input id="code" placeholder="Enter License Code">
    <button onclick="login()">LOGIN</button>
</div>

<script>
// Read redirect URL from query param
const params = new URLSearchParams(window.location.search);
const redirectURL = params.get("redirect") || "index.html";

// Generate Device ID
function getDeviceID() {
    let id = localStorage.getItem("bjc_device_id");
    if(!id){
        id = "dev-" + Math.random().toString(36).substr(2, 16);
        localStorage.setItem("bjc_device_id", id);
    }
    return id;
}

function login() {
    const input = document.getElementById("code").value.trim();
    const deviceID = getDeviceID();

    if (input === "") {
        alert("Enter License Code");
        return;
    }

    let valid = false;

    for (let lic of LICENSES) {
        if (lic.code === input) {

            // First time login, lock device
            if (!lic.device) lic.device = deviceID;

            if (lic.device !== deviceID) {
                alert("LICENSE LOCKED TO ANOTHER DEVICE!");
                return;
            }

            const now = new Date();
            const exp = new Date(lic.expire);
            if (now > exp) {
                alert("LICENSE EXPIRED!");
                return;
            }

            valid = true;
            break;
        }
    }

    if (!valid) {
        alert("INVALID LICENSE!");
        return;
    }

    // Save login locally
    localStorage.setItem("bjc_logged", "1");
    localStorage.setItem("bjc_code", input);
    localStorage.setItem("bjc_device", deviceID);

    // Redirect to HopWeb movies.html
    window.location.href = redirectURL;
}
</script>

</body>
</html>
